<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Timing Checker</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #008F53;
            margin-top: 0;
        }

        .info {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .session-card {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #008F53;
        }

        .session-card h3 {
            margin-top: 0;
            color: #008F53;
        }

        .stat {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }

        .absent-list {
            background: #ffebee;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .absent-item {
            padding: 10px;
            background: white;
            margin-bottom: 10px;
            border-radius: 4px;
            border-left: 3px solid #f44336;
        }

        .btn {
            background: #008F53;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }

        .btn:hover {
            background: #006d3f;
        }

        .btn-danger {
            background: #f44336;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üìä Attendance Timing Checker</h1>

        <div id="loading" class="loading">
            Loading attendance data...
        </div>

        <div id="content" style="display: none;">
            <div class="info">
                <strong>Today:</strong> <span id="today"></span><br>
                <strong>Current Time:</strong> <span id="currentTime"></span><br>
                <strong>Total Records:</strong> <span id="totalRecords"></span>
            </div>

            <div class="summary">
                <div class="session-card">
                    <h3>üåÖ AM Session</h3>
                    <div class="stat">
                        <span>‚úÖ Present (Verified):</span>
                        <strong id="amVerified">0</strong>
                    </div>
                    <div class="stat">
                        <span>‚ùå Absent:</span>
                        <strong id="amAbsent">0</strong>
                    </div>
                    <div class="stat">
                        <span>‚è≥ Pending:</span>
                        <strong id="amPending">0</strong>
                    </div>
                    <div class="stat">
                        <span>üèñÔ∏è On Leave:</span>
                        <strong id="amLeave">0</strong>
                    </div>
                </div>

                <div class="session-card">
                    <h3>üåÜ PM Session</h3>
                    <div class="stat">
                        <span>‚úÖ Present (Verified):</span>
                        <strong id="pmVerified">0</strong>
                    </div>
                    <div class="stat">
                        <span>‚ùå Absent:</span>
                        <strong id="pmAbsent">0</strong>
                    </div>
                    <div class="stat">
                        <span>‚è≥ Pending:</span>
                        <strong id="pmPending">0</strong>
                    </div>
                    <div class="stat">
                        <span>üèñÔ∏è On Leave:</span>
                        <strong id="pmLeave">0</strong>
                    </div>
                </div>
            </div>

            <div class="absent-list" id="absentSection" style="display: none;">
                <h3>‚ùå Personnel Marked as Absent</h3>
                <div id="absentList"></div>
            </div>

            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="location.reload()">üîÑ Refresh</button>
                <button class="btn btn-danger" onclick="resetAttendance()">üóëÔ∏è Reset Today's Attendance</button>
            </div>

            <details>
                <summary
                    style="cursor: pointer; padding: 10px; background: #f5f5f5; border-radius: 5px; margin-bottom: 10px;">
                    <strong>üìã View Raw JSON Data</strong>
                </summary>
                <pre id="rawData"></pre>
            </details>
        </div>
    </div>

    <script>
        async function loadData() {
            try {
                const response = await fetch('check_absent_timing.php');
                const data = await response.json();

                if (data.success) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('content').style.display = 'block';

                    // Display basic info
                    document.getElementById('today').textContent = data.today;
                    document.getElementById('currentTime').textContent = data.current_time;
                    document.getElementById('totalRecords').textContent = data.total_records;

                    // Display summary
                    document.getElementById('amVerified').textContent = data.summary.AM.verified;
                    document.getElementById('amAbsent').textContent = data.summary.AM.absent;
                    document.getElementById('amPending').textContent = data.summary.AM.pending;
                    document.getElementById('amLeave').textContent = data.summary.AM.on_leave;

                    document.getElementById('pmVerified').textContent = data.summary.PM.verified;
                    document.getElementById('pmAbsent').textContent = data.summary.PM.absent;
                    document.getElementById('pmPending').textContent = data.summary.PM.pending;
                    document.getElementById('pmLeave').textContent = data.summary.PM.on_leave;

                    // Display absent details
                    if (data.absent_details && data.absent_details.length > 0) {
                        document.getElementById('absentSection').style.display = 'block';
                        const absentList = document.getElementById('absentList');
                        absentList.innerHTML = data.absent_details.map(record => `
                            <div class="absent-item">
                                <strong>${record.name}</strong> (${record.role})<br>
                                <small>Session: ${record.session} | Marked at: ${record.marked_at}</small>
                            </div>
                        `).join('');
                    }

                    // Display raw data
                    document.getElementById('rawData').textContent = JSON.stringify(data, null, 2);
                } else {
                    document.getElementById('loading').innerHTML = `<div style="color: red;">Error: ${data.message}</div>`;
                }
            } catch (error) {
                document.getElementById('loading').innerHTML = `<div style="color: red;">Error loading data: ${error.message}</div>`;
            }
        }

        async function resetAttendance() {
            if (!confirm('‚ö†Ô∏è Are you sure you want to RESET all attendance records for today? This cannot be undone!')) {
                return;
            }

            const password = prompt('Enter password to confirm:');
            if (password !== 'reset123') {
                alert('‚ùå Invalid password!');
                return;
            }

            try {
                const response = await fetch(`reset_today_attendance.php?password=${password}`);
                const data = await response.json();

                if (data.success) {
                    alert(`‚úÖ Success! Deleted ${data.deleted_count} attendance records.`);
                    location.reload();
                } else {
                    alert(`‚ùå Error: ${data.message}`);
                }
            } catch (error) {
                alert(`‚ùå Error: ${error.message}`);
            }
        }

        // Load data on page load
        loadData();
    </script>
</body>

</html>